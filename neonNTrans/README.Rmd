---
title: "NEON Nitrogen Transformations"
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)

```
<!-- ****** Description ****** -->

This package is for calculating soil extractable inorganic nitrogen (N) concentrations and net N transformation rates (mineralization and nitrification) from soil KCl extracts.

<!-- ****** Usage ****** -->
## Usage
The single function contained in this package, def.calc.ntrans, has the following purpose: (1) join variables across tables and data products (2) calculate blank-corrected inorganic N concentrations in KCl extracts (3) convert from N concentrations in extracts (mg N/L) to soil extractable N concentrations (ug N/g), and (4) calculate net mineralization and nitrification rates using intital and incubated core pairs. See the function help file for additional details. The general flow of using this package is:

1. download data from the NEON data portal. 
2. _optional_ use the neonDataStackR package in the NEON-utilities repository (https://github.com/NEONScience/NEON-utilities) to stack monthly files by table
3. load files for each input table required by the function
4. out <- def.calc.ntrans(kclInt = df1, kclIntBlank = df2, kclExt = df3, soilMoist = df4) returns a data frame with inorganic N concentrations in ug N per g dry soil. Additionally, it contains net N transformation rates in ug N per g per day for incubated samples if data from both initial and final cores are available.


<!-- ****** Calculation Summary ****** -->
## Calculation Summary
The first step in converting inorganic N concentrations in KCl extracts to soil extractable inorganic N is to  blank-correct the concentration values (mg/L) for each sample. This is necessary because blanks can contain substantial ammounts of ammonium and nitrate, and this contaminant N must be accounted for. The def.calc.ntrans function thus estimates mean N concentration in the set of blanks associated with each batch of samples (typically, n = 3), then subtracts the mean blank value from measured ammonium and nitrate+nitrite concentrations.

Next, blank-corrected concentrations are converted from milligrams N per liter to micrograms N per gram by dividing by the mass of dry soil extracted and multiplying by extraction volume. To calculate the mass of dry soil extracted, the def.calc.ntrans function uses the soil dry mass fraction provided for each sample in the soil moisture table.

Lastly, if data is available for both an initial and final core in the pair, net N mineralization is calculated as the difference in final minus initial inorganic N (ammonium plus nitrate+nitrite N), divided by the incubation length. Net nitrification is calucated as the difference between final and intital nitrate+nitrite N, divided by the incubation length.

The def.calc.ntrans function provides a summary of how many records are missing soil concentration estimates due to lack of dry mass fraction data in the soil moisture table. Moreover, when user decide to filter out data based on specific condition values for external laboratory flags, the function also provides a summrary of how many records are affected.

<!-- ****** Acknowledgements ****** -->
## Credits & Acknowledgements

<!-- HTML tags to produce image, resize, add hyperlink. -->
<!-- ONLY WORKS WITH HTML or GITHUB documents -->
<a href="http://www.neonscience.org/">
<img src="logo.png" width="300px" />
</a>


<!-- Acknowledgements text -->
The National Ecological Observatory Network is a project solely funded by the National Science Foundation and managed under cooperative agreement by Battelle. Any opinions, findings, and conclusions or recommendations expressed in this material are those of the author(s) and do not necessarily reflect the views of the National Science Foundation.



<!-- ****** License ****** -->
## License

GNU AFFERO GENERAL PUBLIC LICENSE Version 3, 19 November 2007



<!-- ****** Disclaimer ****** -->
## Disclaimer

*Information and documents contained within this pachage are available as-is. Codes or documents, or their use, may not be supported or maintained under any program or service and may not be compatible with data currently available from the NEON Data Portal.*